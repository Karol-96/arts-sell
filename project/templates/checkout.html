{% extends 'layout.html' %}

{% block title %}Checkout - ArtSpace{% endblock %}

{% block main %}
<div class="checkout-container">
    <!-- Progress Steps -->
    <div class="checkout-progress">
        <div class="container">
            <div class="progress-steps">
                <div class="step completed">
                    <div class="step-number">1</div>
                    <div class="step-label">Lease Cart</div>
                </div>
                <div class="step completed">
                    <div class="step-number">2</div>
                    <div class="step-label">Checkout</div>
                </div>
                <div class="step active">
                    <div class="step-number">3</div>
                    <div class="step-label">Confirmation</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="checkout-header">
            <h1 class="display-5 fw-bold text-center mb-3">Complete Your Lease Subscription</h1>
            <p class="lead text-center text-muted mb-5">Review your order details and complete your monthly art lease subscription securely.</p>
        </div>

        <form method="POST" action="{{ url_for('main.process_payment') }}" class="checkout-form">
            <div class="row g-5">
                <div class="col-lg-8">
                    <!-- Delivery Information Section -->
                    <div class="checkout-section">
                        <div class="section-header">
                            <h4 class="section-title">
                                <i class="section-icon">üöö</i>
                                Delivery & Setup Information
                            </h4>
                            <p class="section-subtitle">We'll deliver and professionally install your artwork</p>
                        </div>
                        
                        <div class="section-content">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">First Name</label>
                                    <input type="text" class="form-control form-control-lg" value="{{ current_user.firstname }}" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Last Name</label>
                                    <input type="text" class="form-control form-control-lg" value="{{ current_user.lastname }}" readonly>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-semibold">Email Address</label>
                                <input type="email" class="form-control form-control-lg" value="{{ current_user.email }}" readonly>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-semibold">Phone Number</label>
                                <input type="text" class="form-control form-control-lg" value="{{ current_user.phone if current_user.phone else 'Not provided' }}" readonly>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-semibold">Delivery Address</label>
                                <textarea class="form-control form-control-lg" rows="3" readonly>{{ current_user.address if current_user.address else 'Please update your profile with delivery address' }}</textarea>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-semibold">City</label>
                                    <input type="text" class="form-control form-control-lg" value="{{ current_user.city if current_user.city else 'N/A' }}" readonly>
                                </div>
                                <div class="col-md-3 mb-4">
                                    <label class="form-label fw-semibold">State</label>
                                    <input type="text" class="form-control form-control-lg" value="{{ current_user.state if current_user.state else 'N/A' }}" readonly>
                                </div>
                                <div class="col-md-3 mb-4">
                                    <label class="form-label fw-semibold">ZIP Code</label>
                                    <input type="text" class="form-control form-control-lg" value="{{ current_user.zip if current_user.zip else 'N/A' }}" readonly>
                                </div>
                            </div>

                            <div class="delivery-options">
                                <h6 class="fw-semibold mb-3">Delivery Preferences</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="delivery_time" id="morning" value="morning" checked>
                                            <label class="form-check-label" for="morning">
                                                <strong>Morning (9 AM - 12 PM)</strong>
                                                <small class="d-block text-muted">Best for home deliveries</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="delivery_time" id="afternoon" value="afternoon">
                                            <label class="form-check-label" for="afternoon">
                                                <strong>Afternoon (1 PM - 5 PM)</strong>
                                                <small class="d-block text-muted">Best for office deliveries</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="section-actions">
                                <a href="{{ url_for('main.profile') }}" class="btn btn-outline-primary">
                                    <i class="edit-icon">‚úèÔ∏è</i> Edit Delivery Information
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Information Section -->
                    <div class="checkout-section">
                        <div class="section-header">
                            <h4 class="section-title">
                                <i class="section-icon">üí≥</i>
                                Payment Information
                            </h4>
                            <p class="section-subtitle">Secure payment processing for your monthly lease</p>
                        </div>
                        
                        <div class="section-content">
                            <div class="mb-4">
                                <label class="form-label fw-semibold">Payment Method</label>
                                <select class="form-select form-select-lg" name="payment_method" required>
                                    <option value="credit_card">üí≥ Credit Card</option>
                                    <option value="debit_card">üí≥ Debit Card</option>
                                    <option value="paypal">üÖøÔ∏è PayPal</option>
                                    <option value="bank_transfer">üè¶ Bank Transfer</option>
                                </select>
                            </div>

                            <div class="card-details">
                                <div class="mb-4">
                                    <label class="form-label fw-semibold">Card Number</label>
                                    <input type="text" class="form-control form-control-lg" name="card_number" 
                                           placeholder="1234 5678 9012 3456" maxlength="19" required>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label fw-semibold">Expiration Date</label>
                                        <input type="text" class="form-control form-control-lg" name="expiry_date" 
                                               placeholder="MM/YY" maxlength="5" required>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label fw-semibold">CVV</label>
                                        <input type="text" class="form-control form-control-lg" name="cvv" 
                                               placeholder="123" maxlength="4" required>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-semibold">Cardholder Name</label>
                                    <input type="text" class="form-control form-control-lg" name="card_name" 
                                           placeholder="Name as it appears on card" required>
                                </div>

                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="save_card" name="save_card">
                                    <label class="form-check-label" for="save_card">
                                        <strong>Save payment method for future leases</strong>
                                        <small class="d-block text-muted">Securely store your payment information for easy monthly renewals</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lease Terms Section -->
                    <div class="checkout-section">
                        <div class="section-header">
                            <h4 class="section-title">
                                <i class="section-icon">üìã</i>
                                Lease Terms & Conditions
                            </h4>
                            <p class="section-subtitle">Important information about your monthly art lease</p>
                        </div>
                        
                        <div class="section-content">
                            <div class="lease-terms">
                                <div class="term-item">
                                    <h6 class="fw-semibold">Monthly Subscription</h6>
                                    <p class="text-muted">Your lease automatically renews monthly. You can cancel anytime with 30 days notice.</p>
                                </div>
                                <div class="term-item">
                                    <h6 class="fw-semibold">Free Delivery & Setup</h6>
                                    <p class="text-muted">Professional installation and pickup service included at no extra cost.</p>
                                </div>
                                <div class="term-item">
                                    <h6 class="fw-semibold">Insurance Coverage</h6>
                                    <p class="text-muted">All artworks are fully insured during the lease period.</p>
                                </div>
                                <div class="term-item">
                                    <h6 class="fw-semibold">Easy Exchange</h6>
                                    <p class="text-muted">Swap artworks anytime to refresh your space with new pieces.</p>
                                </div>
                            </div>

                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="agree_terms" name="agree_terms" required>
                                <label class="form-check-label" for="agree_terms">
                                    <strong>I agree to the <a href="#" class="text-primary">Terms of Service</a> and <a href="#" class="text-primary">Privacy Policy</a></strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Order Summary Card -->
                    <div class="order-summary-card">
                        <div class="summary-header">
                            <h4 class="summary-title">
                                <i class="summary-icon">üìã</i>
                                Lease Summary
                            </h4>
                            <p class="summary-subtitle">Monthly subscription details</p>
                        </div>

                        <div class="summary-content">
                            <!-- Artwork Items -->
                            <div class="artwork-items">
                                {% for item in items %}
                                <div class="artwork-item">
                                    <div class="item-image">
                                        <img src="{{ url_for('static', filename=item.image_url if item.image_url else 'img/feature-slide-1.png') }}" 
                                             alt="{{ item.title }}" class="img-fluid">
                                    </div>
                                    <div class="item-details">
                                        <h6 class="item-title">{{ item.title }}</h6>
                                        <p class="item-artist">by {{ item.artist_name }}</p>
                                        <p class="item-medium">{{ item.medium }}</p>
                                    </div>
                                    <div class="item-price">
                                        <span class="price">${{ "%.2f"|format(item.price) }}</span>
                                        <small class="price-period">/month</small>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                            <hr class="summary-divider">

                            <!-- Pricing Breakdown -->
                            <div class="pricing-breakdown">
                                <div class="price-row">
                                    <span class="price-label">Monthly Subtotal</span>
                                    <span class="price-value">${{ "%.2f"|format(subtotal) }}</span>
                                </div>
                                <div class="price-row">
                                    <span class="price-label">Delivery & Setup</span>
                                    <span class="price-value free">FREE</span>
                                </div>
                                <div class="price-row">
                                    <span class="price-label">Insurance</span>
                                    <span class="price-value free">INCLUDED</span>
                                </div>
                                <div class="price-row">
                                    <span class="price-label">Tax</span>
                                    <span class="price-value">${{ "%.2f"|format(tax) }}</span>
                                </div>
                            </div>

                            <hr class="summary-divider">

                            <!-- Total -->
                            <div class="total-section">
                                <div class="total-row">
                                    <span class="total-label">Monthly Total</span>
                                    <span class="total-value">${{ "%.2f"|format(total) }}</span>
                                </div>
                                <small class="total-note">Recurring monthly charge</small>
                            </div>

                            <!-- Action Buttons -->
                            <div class="summary-actions">
                                <button type="submit" class="btn btn-complete-order w-100 mb-3">
                                    <i class="btn-icon">‚úÖ</i>
                                    Complete Lease Subscription
                                </button>
                                
                                <a href="{{ url_for('main.basket') }}" class="btn btn-outline-secondary w-100 mb-3">
                                    <i class="btn-icon">‚Üê</i>
                                    Back to Lease Cart
                                </a>
                            </div>

                            <!-- Security Badge -->
                            <div class="security-badge">
                                <div class="security-content">
                                    <i class="security-icon">üîí</i>
                                    <div class="security-text">
                                        <strong>Secure Payment</strong>
                                        <small>SSL Encrypted & PCI Compliant</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Methods Card -->
                    <div class="payment-methods-card">
                        <h6 class="card-title">Accepted Payment Methods</h6>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <i class="payment-icon">üí≥</i>
                                <span>Visa</span>
                            </div>
                            <div class="payment-method">
                                <i class="payment-icon">üí≥</i>
                                <span>Mastercard</span>
                            </div>
                            <div class="payment-method">
                                <i class="payment-icon">üí≥</i>
                                <span>American Express</span>
                            </div>
                            <div class="payment-method">
                                <i class="payment-icon">üÖøÔ∏è</i>
                                <span>PayPal</span>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Support Card -->
                    <div class="support-card">
                        <h6 class="card-title">Need Help?</h6>
                        <div class="support-options">
                            <div class="support-option">
                                <i class="support-icon">üìû</i>
                                <div class="support-text">
                                    <strong>Call Us</strong>
                                    <small>1-800-ART-LEASE</small>
                                </div>
                            </div>
                            <div class="support-option">
                                <i class="support-icon">üí¨</i>
                                <div class="support-text">
                                    <strong>Live Chat</strong>
                                    <small>Available 24/7</small>
                                </div>
                            </div>
                            <div class="support-option">
                                <i class="support-icon">üìß</i>
                                <div class="support-text">
                                    <strong>Email</strong>
                                    <small>support@artspace.com</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}